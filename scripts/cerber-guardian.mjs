#!/usr/bin/env node
// Generated by Cerber init - DO NOT EDIT MANUALLY
// To regenerate: npx cerber init --force

import { execSync } from 'child_process';
import fs from 'fs';

const SCHEMA_FILE = 'BACKEND_SCHEMA.ts';
const APPROVALS_TAG = 'approved-by-team';

async function main() {
  console.log('ğŸ›¡ï¸  Cerber Guardian: Validating staged files...');

  if (!fs.existsSync(SCHEMA_FILE)) {
    console.error(`âŒ Schema file not found: ${SCHEMA_FILE}`);
    console.error('Guardian MVP: schema missing. Add your rules to proceed.');
    process.exit(1);
  }

  let stagedFiles;
  try {
    stagedFiles = execSync('git diff --cached --name-only', { encoding: 'utf-8' })
      .trim()
      .split('\n')
      .filter(Boolean);
  } catch (err) {
    console.error('âŒ Failed to get staged files');
    process.exit(1);
  }

  if (stagedFiles.length === 0) {
    console.log('âœ… No files staged for commit');
    return;
  }

  console.log(`Checking ${stagedFiles.length} file(s)...`);
  console.log('Guardian MVP: schema detected. Add validation rules to enforce imports/forbidden patterns.');
  console.log('âœ… All checks passed');
}

main().catch(err => {
  console.error('âŒ Guardian check failed:', err?.message || err);
  process.exit(1);
});
